{% extends 'base.html'%}
{% block title %}Inventario {% endblock %}
{% block content %}
<div class="container mb-4">
  <h3>Gestión de Inventario</h3>
  <button class="btn btn-personalizado" data-bs-toggle="modal" data-bs-target="#modalAgregar">Agregar productos</button>

  <br><br>
  <table class="table table-bordered table-hover">
    <thead class="table-light">
      <tr>
        <th>Imagen</th>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Tipo</th>
        <th>Tallas</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for p in productos %}
      <tr>
        <td><img src="{{ url_for('static', filename='uploads/' + p.imagen)
}}" width="80"></td>
        <td>{{ p.nombre_producto }}</td>
        <td>{{ p.precio }}</td>
        <td>{{ p.tipo }}</td>
        <td>
          {% if p.tallas_cantidades %}
          {% for talla, cantidad in p.tallas_cantidades.items() %}
          <span class="badge bg-secondary">{{ talla }}: {{ cantidad
            }}</span>
          {% endfor %}
          {% else %}
          Sin tallas
          {% endif %}
        </td>
        <td>
          <button class="btn btn-outline-secondary" data-bs-toggle="modal"
            data-bs-target="#modalEditar{{ p.id_producto }}">Editar</button>
          <button class="btn btn-outline-danger" onclick="if(confirm('¿Estás seguro de eliminar este producto?')){ window.location.href='{{ url_for('eliminar_producto',id=p.id_producto) }}' }">Eliminar</button>
        </td>
      </tr>
      <!-- Modal de edición -->
      <div class="modal fade" id="modalEditar{{ p.id_producto }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <form method="POST" action="{{ url_for('editar_producto',
id=p.id_producto) }}" enctype="multipart/form-data">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Editar producto</h5>
                <button type="button" class="btn-close" data-bsdismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="nombre{{ p.id_producto }}" class="formlabel">Nombre</label>
                    <input type="text" class="form-control" name="nombre" id="nombre{{ p.id_producto }}"
                      value="{{ p.nombre_producto }}" required>
                  </div>
                  <div class="col-md-6">
                    <label for="precio{{ p.id_producto }}" class="formlabel">Precio</label>
                    <input type="number" class="form-control" name="precio" id="precio{{ p.id_producto }}"
                      value="{{ p.precio }}" required>
                  </div>
                  <div class="col-md-12">
                    <label for="imagen{{ p.id_producto }}" class="formlabel">Imagen</label>
                    <input type="file" class="form-control" name="imagen" id="imagen{{ p.id_producto }}">
                    <small class="text-muted">Archivo actual: {{ p.imagen
                      }}</small>
                  </div>
                </div>
                <div class="col-md-12 mt-3">
                  <label class="form-label">Tallas y cantidades</label>
                  <div class="row">
                    {% for talla in ['XS', 'S', 'M', 'L', 'XL'] %}
                    <div class="col-md-6 mb-2">
                      <div class="input-group">
                        <span class="input-group-text">{{ talla }}</span>
                        <input type="number" class="form-control" name="talla_{{ talla }}" value="{{ p.tallas_cantidades[talla] if talla
in p.tallas_cantidades else '' }}" min="0">
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                <label for="tipo">Tipo de producto:</label>
                <select name="tipo" id="tipo" class="form-control" required>
                  <option value="venta" {% if p.tipo=='venta' %}selected{% endif %}>Solo venta</option>
                  <option value="alquiler" {% if p.tipo=='alquiler' %}selected{% endif %}>Solo alquiler</option>
                  <option value="ambos" {% if p.tipo=='ambos' %}selected{% endif %}>Ambos</option>
                </select>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Guardar
                  cambios</button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      {% endfor %}
    </tbody>
  </table>
  <!-- Modal agregar producto -->
  <div class="modal fade" id="modalAgregar" tabindex="-1" ariahidden="true">
    <div class="modal-dialog">
      <form method="POST" action="{{ url_for('agregar_producto') }}" enctype="multipart/form-data">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Agregar producto</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" name="nombre" id="nombre" required>
              </div>
              <div class="col-md-6">
                <label for="precio" class="form-label">Precio</label>
                <input type="number" class="form-control" name="precio" id="precio" required>
              </div>
              <div class="col-md-12">
                <label for="imagen" class="form-label">Imagen</label>
                <input type="file" class="form-control" name="imagen" id="imagen" required>
              </div>
            </div>
            <div class="col-md-12 mt-3">
              <label class="form-label">Tallas y cantidades</label>
              <div class="row">
                {% for talla in ['XS', 'S', 'M', 'L', 'XL'] %}
                <div class="col-md-6 mb-2">
                  <div class="input-group">
                    <span class="input-group-text">{{ talla }}</span>
                    <input type="number" class="form-control" name="talla_{{
talla }}" min="0" placeholder="Cantidad">
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            <label for="tipo">Tipo de producto:</label>
            <select name="tipo" id="tipo" class="form-control" required>
              <option value="venta">Solo venta</option>
              <option value="alquiler">Solo alquiler</option>
              <option value="ambos">Ambos</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}